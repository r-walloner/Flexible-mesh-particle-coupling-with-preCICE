# CFD-DEM: fluidized bed
This is the fluidized bed scenario from Section 4.4 of the bachelor's thesis *Flexible mesh-particle coupling with preCICE* by Robin Walloner.

## Contents

### `template/` and `generate.py`
The `generate.py` script generates instances of the fluidized bed case from the blueprint found within `template/`.
To generate one or more runs, modify the parameters and logic found at the end of `generate.py` and run the script.
The runs are generated in the `runs/` directory.

### `run.py`
Executes the runs within the `runs/` directory.
By default, all runs are executet.
To execute select runs, pass their paths as arguments like this:
```sh
python run.py runs/run-1 runs/run-2
```

### `runs/`
Contains the case instances generated by `generate.py`.

### `plot_particle_flux.py`
Generates the particle mass flux plot from the results within the `runs/` directory.

### `plot_load_balancing.py`
Generates the load balancing plot from the `log.liggghts` file within a run.
Adjust the `log_path` variable at the top of the script to point to the `log.liggghts` file you want to analyze.
Note, that LIGGGHTS only logs the data required by this script if the `post yes` argument is specified in the `run` command of the input script.
However, this decreases performance, so it is not enabled by default.

### `reference_data/`
Data from [Link](https://doi.org/10.1016/j.ces.2005.01.027) we use to validate against.

## Reproducing results

### Requirements
- [preCICE](https://precice.org/installation-overview.html) with support for coarse-graining (tested with the version provided in this dataset)
- Our modified version of LIGGGHTS
- [OpenFOAM](https://www.openfoam.com/current-release) (tested with version 2412)
- Our AndersonJacksonFoam solver
- Our modified version of the [OpenFOAM-preCICE adapter](https://precice.org/adapter-openfoam-get.html)
- [Python](https://www.python.org/downloads/) (tested with version 3.13.5)
- [Python packages](https://packaging.python.org/en/latest/guides/installing-using-pip-and-virtual-environments/#using-a-requirements-file) listed in `requirements.txt`

### Running
Generate one or more runs with:
```sh
python generate.py
```
Then run them with:
```sh
python run.py
```
Alternatively, you can run manually by opening two separate terminals, navigating to a run and using the provided `run.sh` scripts.

Now, you can plot the results using:
```sh
python plot_particle_velocity.py
```

### Generating initial data for alpha
As described in Section 3.5.2, we need to initialize `alphaSolid` with realistic values.
For the current parameters set in `generate.py` the file `template/0/alphaSolid` allready contains suitable initial conditions.
If you change any parameters that affect the initial condition of the simulation, you need to regenrate the initial data for `alphaSolid` as described below, otherwise the fluid solver will crash after a few time steps.
1. Generate run using `generate.py`.
2. In `system/controlDict` of the generated run, set `writeInterval` to equal `deltaT` and disable `writeCompression`.
3. Run until the fluid solver completes its second time step. Note that, initially, the particle solver runs uncoupled to allow the particles to settle.
4. Overwrite `0/alphaSolid` with the `alphaSolid` from the second time step (e.g., `0.00002/alphaSolid`).
5. Restore `writeInterval` and `writeCompression` to their original values and clean the case. Now, the run is ready to be executed.
